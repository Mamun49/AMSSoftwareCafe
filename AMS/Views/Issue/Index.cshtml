
@{

    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    List<SelectListItem> Storelist = ViewBag.Storelist;
    //List<SelectListItem> Supplist = ViewBag.SuppList;
    List<SelectListItem> Catlist = ViewBag.CatList;
}

<!DOCTYPE html>

<!--  Navbar Starts / Breadcrumb Area  -->
<div class="sub-header-container">
    <header class="header navbar navbar-expand-sm">
        <a href="javascript:void(0);" class="sidebarCollapse" data-placement="bottom">
            <i class="las la-bars"></i>
        </a>
        <ul class="navbar-nav flex-row">
            <li>
                <div class="page-header">
                    <nav class="breadcrumb-one" aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="javascript:void(0);">Issue</a></li>
                            <li class="breadcrumb-item active" aria-current="page"><span>Issue Item</span></li>

                        </ol>
                    </nav>
                </div>
            </li>
        </ul>

        <ul class="navbar-nav d-flex align-center ml-auto right-side-filter">
            <li class="nav-item more-dropdown">
                <div class="input-group input-group-sm">
                    <input id="rangeCalendarFlatpickr" class="form-control flatpickr flatpickr-input active" type="text" placeholder="Select">
                    <div class="input-group-append">
                        <span class="input-group-text bg-primary border-primary" id="basic-addon2">
                            <i class="lar la-calendar"></i>
                        </span>
                    </div>
                </div>
            </li>
            <li class="nav-item more-dropdown">
                <a href="javascript: void(0);" data-original-title="Reload Data" data-placement="bottom" class="btn btn-primary dash-btn btn-sm ml-2 bs-tooltip">
                    <i class="las la-sync"></i>
                </a>
            </li>
            <li class="nav-item custom-dropdown-icon">
                <a href="javascript: void(0);" data-original-title="Filter" data-placement="bottom" id="customDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-primary dash-btn btn-sm ml-2 bs-tooltip">
                    <i class="las la-filter"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="customDropdown">
                    <a class="dropdown-item" data-value="Filter 1" href="javascript:void(0);">Filter 1</a>
                    <a class="dropdown-item" data-value="Filter 2" href="javascript:void(0);">Filter 2</a>
                    <a class="dropdown-item" data-value="Filter 3" href="javascript:void(0);">Filter 3</a>
                </div>
            </li>
        </ul>
    </header>
</div>
<div class="layout-px-spacing">
    <div class="layout-top-spacing mb-2">
        <div class="col-md-12">
            <div class="row">
                <div class="container p-0">
                    <div class="row layout-top-spacing">
                        <div class="col-lg-9 layout-spacing">
                            <div class="statbox widget box box-shadow mb-4">
                                <div class="widget-header">
                                    <div class="row">
                                        <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                            <h4>Issue Item Form</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="widget-content widget-content-area">
                                    <div class="form-group row">
                                        <div class="col-lg-12 col-md-12 col-sm-12">
                                            <form class="needs-validation" novalidate action="javascript:void(0);">
                                                <div class="form-row">
                                                    <div class="col-md-4 mb-4">
                                                        <label for="validationCustom01">Date</label>

                                                        <input id="datepick" class="form-control flatpickr flatpickr-input active" type="date" required value ="today();">

                                                    </div>
                                                    <div class="col-md-4 mb-4">
                                                        <label for="validationCustom01">Year</label>
                                                        <input type="number" class="form-control" disabled="disabled" value="@DateTime.Now.Year" placeholder="@DateTime.Now.Year" id="year">

                                                    </div>
                                                    <div class="col-md-4 mb-4">
                                                        <label for="validationCustom02">Invoice No</label>
                                                        <input type="text" class="form-control" id="memoid" disabled="disabled" placeholder="@ViewBag.Memo" value="@ViewBag.Memo">

                                                    </div>


                                                </div>
                                                <div class="form-row">
                                                    <div class="col-md-6 mb-6">
                                                        <label for="validationCustom01">Store From</label>
                                                        <select class="form-control" id="storeid">
                                                            @for (int i = 0; i < Storelist.Count; i++)
                                                            {

                                                                <option value="@Storelist[i].Value">@Storelist[i].Text</option>
                                                            }
                                                        </select>

                                                    </div>
                                                    <div class="col-md-6 mb-6">
                                                        <label for="validationCustom02">Store To</label>
                                                        <select class="form-control" id="suppid">
                                                            @for (int i = 0; i < Storelist.Count; i++)
                                                            {

                                                                <option value="@Storelist[i].Value">@Storelist[i].Text</option>
                                                            }
                                                        </select>
                                                        @*<select class="form-control" id="suppid">
                                                            @for (int i = 0; i < Supplist.Count; i++)
                                                            {

                                                                <option value="@Supplist[i].Value">@Supplist[i].Text</option>
                                                            }
                                                        </select>*@

                                                    </div>

                                                </div>
                                                <br />

                                                <div class="form-row">
                                                    <div class="col-md-3 mb-3">
                                                        <label for="validationCustom01">Category</label>
                                                        <select class="form-control" id="Catid">
                                                            @for (int i = 0; i < Catlist.Count; i++)
                                                            {

                                                                <option value="@Catlist[i].Value">@Catlist[i].Text</option>
                                                            }
                                                        </select>

                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label for="validationCustom01">Sub Category</label>
                                                        <select class="form-control" id="SubCatid">
                                                        </select>

                                                    </div>
                                                    <div class="col-md-6 mb-6">
                                                        <label for="validationCustom02">Item Name</label>
                                                        <input type="email" class="form-control" id="itemname">

                                                    </div>


                                                </div>
                                                <br />
                                                <div class="form-row">
                                                    <div class="col-md-2 mb-2">
                                                        <label for="validationCustom02">Size</label>
                                                        <input type="email" class="form-control" id="size">

                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label for="validationCustom02">Color</label>
                                                        <input type="email" class="form-control" id="colorid">

                                                    </div>
                                                    <div class="col-md-2 mb-2">
                                                        <label for="validationCustom02">QTY</label>
                                                        <input type="email" class="form-control" id="qty">

                                                    </div>
                                                    <div class="col-md-2 mb-2">
                                                        <label for="validationCustom01">Rate</label>
                                                        <input type="email" class="form-control" id="rate">

                                                    </div>
                                                    <div class="col-md-2 mb-2">
                                                        <label for="validationCustom01">Amount</label>
                                                        <input type="email" class="form-control" disabled="disabled" id="amount">

                                                    </div>
                                                    @*<div class="col-md-2 mb-2">
                                                            <label for="validationCustom02">Discount(%)</label>
                                                            <input type="email" class="form-control" >

                                                        </div>
                                                        <div class="col-md-2 mb-2">
                                                            <label for="validationCustom02">Discount</label>
                                                            <input type="email" class="form-control" >

                                                        </div>*@
                                                    @*<div class="col-md-3 mb-3">
                                                            <label for="validationCustom02">Gross Amount</label>
                                                            <input type="email" class="form-control" disabled="disabled" id="grosamount">

                                                        </div>*@
                                                    <div class="col-md-1 mb-1">

                                                        <br />
                                                        <input type="submit" value="Add" class="btn btn-primary mt-3" id="additem" />

                                                    </div>

                                                </div>

                                                @*<input type="submit" value="Create" class="btn btn-primary mt-3" />*@

                                            </form>

                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 layout-spacing">
                            <div class="statbox widget box box-shadow mb-4">
                                <div class="widget-header">
                                    <div class="row">
                                        <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                            <h4>Payment Master</h4>
                                        </div>
                                    </div>
                                </div>

                                <div class="widget-content widget-content-area">
                                    <div class="form-group row">
                                        <div class="col-lg-12 col-md-12 col-sm-12">
                                            <form class="needs-validation" novalidate action="javascript:void(0);">
                                                <div class="form-row">
                                                    <div class="col-md-12 mb-12">
                                                        <label for="validationCustom01">Total Amount</label>
                                                        <input type="email" class="form-control" id="totalamount">

                                                    </div>
                                                    <div class="col-md-12 mb-12">
                                                        <label for="validationCustom02">Discount</label>
                                                        <input type="email" class="form-control" disabled="disabled">

                                                    </div>

                                                </div>
                                                <div class="form-row">
                                                    <div class="col-md-12 mb-12">
                                                        <label for="validationCustom01">VAT</label>
                                                        <input type="email" class="form-control" disabled="disabled">

                                                    </div>
                                                    <div class="col-md-12 mb-12">
                                                        <label for="validationCustom02">Gross Amount</label>
                                                        <input type="email" class="form-control" disabled="disabled">

                                                    </div>

                                                </div>



                                                <input type="submit" value="Save Invoice" class="btn btn-primary mt-3" id="saveOrder" />

                                            </form>

                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>


                        <div class="table-responsive mb-9">
                            <table id="basic-dt" class="table table-hover" style="width:70%">
                                <thead>
                                    <tr>




                                        <th style="width:30%"> Item Name</th>
                                        <th style="width:10%"> Size</th>
                                        <th style="width:20%"> Color</th>
                                        <th style="width:10%"> QTY</th>
                                        <th style="width:10%"> Rate</th>

                                        <th style="width:10%" id="col1"> Amount</th>


                                        <th style="width:10%">Action</th>

                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        @*extra space*@

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        var emptyrow = "<tr><td colspan='5' class = 'text-center'> Add Product</td></tr>";
        $("#Catid").change(function () {
            $.get("/Issue/GetCategoryList", { CID: $("#Catid").val() }, function (data) {
                $("#SubCatid").empty();

                $.each(data, function (index, row) {
                    /*var row = "<tr><td>" + row.SubCatName + "</td></tr>";*/
                    $("#SubCatid").append("<option value= '" + row.SCID + "'>" + row.SubCatName + " </option>")
                    $('#name').prop('selectedIndex', 0);
                });
            });
        })
    });
    $('#qty, #rate').keyup(function () {
        var rate = parseFloat($('#qty').val()) || 0;
        var box = parseFloat($('#rate').val()) || 0;

        $('#amount').val(rate * box);
    });

    //$("#datepick").datepicker({
    //    autoclose: true,
    //    format: "yyyy-mm-dd",
    //    immediateUpdates: true,
    //    todayBtn: true,
    //    todayHighlight: true
    //}).datepicker("setDate", "0");


    $("#additem").click(function (e) {
        e.preventDefault();

        var ITEMSL = $("#itemname").val();
        var SIZE = $("#size").val();
        var COLOR = $("#colorid").val();
        var QTY = $("#qty").val();
        var RATE = $("#rate").val();
        var AMOUNT = $("#amount").val();
        var detailsTableBody = $("#basic-dt tbody");

        var productItem = '<tr><td>' + ITEMSL + '</td><td>' + SIZE + '</td><td>' + COLOR + '</td><td>' + QTY + '</td><td>' + RATE + '</td><td>' + AMOUNT + '</td><td><a data-itemId="0" href="#" class="btn btn-danger deleteItem">Remove</a></td></tr>';
        detailsTableBody.append(productItem);
        clearItem();

        let total = 0;
        let trCount = $('tr').length;
        for (i = 1; i < trCount; i++) {
            let tdtext = $("tr:eq(" + i + ") td:eq(5)").text();
            total += Number(tdtext);
        }
        $("#totalamount").val(total);
    });


    //After Add A New Order In The List, Clear Clean The Form For Add More Order.
    function clearItem() {
        $("#itemname").val('');
        $("#size").val('');
        $("#colorid").val('');
        $("#qty").val('');
        $("#rate").val('');
        $("#amount").val('');
    }
    $(document).on('click', 'a.deleteItem', function (e) {
        e.preventDefault();
        var $self = $(this);
        if ($(this).attr('data-itemId') == "0") {
            $(this).parents('tr').css("background-color", "#ff6347").fadeOut(800, function () {
                $(this).remove();
            });
        }
    });
    function saveOrder(data) {
        return $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            type: 'POST',
            url: "/Issue/SaveProduct",
            data: data,
            success: function (result) {
                alert(result);
                location.reload();
            },
            error: function () {
                alert("Error! Select Date")
            }
        });
    }
    $("#saveOrder").click(function (e) {
        e.preventDefault();

        var orderArr = [];
        orderArr.length = 0;

        $.each($("#basic-dt tbody tr"), function () {
            orderArr.push({

                ITEMSL: $(this).find('td:eq(0)').html(),
                SIZE: $(this).find('td:eq(1)').html(),
                COLOR: $(this).find('td:eq(2)').html(),
                QTY: $(this).find('td:eq(3)').html(),
                RATE: $(this).find('td:eq(4)').html(),
                AMOUNT: $(this).find('td:eq(5)').html()
            });
        });


        var data = JSON.stringify({
            TRANSDT : $("#datepick").val(),
            TRANSYY : $("#year").val(),
            TRANSNO : $("#memoid").val(),
            STOREFR : $("#storeid option:selected").val(),
            STORETO : $("#suppid option:selected").val(),
            TotalAmount: $("#totalamount").val(),
            order: orderArr
        });

        $.when(saveOrder(data)).then(function (response) {
            console.log(response);
        }).fail(function (err) {
            console.log(err);
        });
    });

</script>

